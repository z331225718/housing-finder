# 房源管理系统设计方案

**项目名称**：上海房源管理系统
**创建日期**：2026-02-27
**版本**：v1.0

---

## 1. 需求概述

### 1.1 项目背景

用户在上海市看房，每周实地看房并记录房源信息，需要同步给两位家人查看。家人均有笔记本电脑，偏好通过网页浏览器访问。

### 1.2 核心需求

- 记录小区信息（对口学区、环境打分等）
- 记录房源信息（价格、租售比、照片视频等）
- 支持照片和视频上传
- 家人只读访问
- 免费部署方案

---

## 2. 技术架构

### 2.1 技术栈

| 层级 | 技术选型 | 说明 |
|------|---------|------|
| 前端 | React + Vite + TypeScript | 现代快速 |
| 后端 | Python FastAPI | 轻量高性能 |
| 数据库 | SQLite | 简单易用 |
| 文件存储 | Cloudflare R2 | 免费 10GB/月 |
| 部署 | Cloudflare Pages + Workers | 免费额度 |
| 认证 | 简单密码 + JWT | 无需邮箱验证 |

### 2.2 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        用户角色                               │
├─────────────────────────────────────────────────────────────┤
│  用户（记录员）              家人（查看者）                     │
│      ↓                            ↑                         │
│   浏览器/手机                   浏览器                        │
│      ↓                            ↑                         │
│   ───────────────────────────────────────                   │
│                   Cloudflare Pages                          │
│               (React + Vite 静态网站)                        │
│      ↓                            ↑                         │
│              FastAPI 后端服务                               │
│      ↓                            ↑                         │
│           SQLite 数据库                                     │
│      ↓                            ↑                         │
│        Cloudflare R2 (照片/视频)                           │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 数据模型

### 3.1 小区表 (communities)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键自增 |
| name | TEXT | 小区名称 |
| district | TEXT | 所属区 |
| address | TEXT | 详细地址 |
| property_fee | TEXT | 物业费 |
| parking | TEXT | 停车位 |
| build_year | INTEGER | 建成年份 |
| metro | TEXT | 周边配套/地铁 |
| primary_school | TEXT | 对口小学 |
| middle_school | TEXT | 对口中学 |
| environment_score | INTEGER | 环境打分 1-10 |
| photos | TEXT | 照片路径(JSON数组) |
| videos | TEXT | 视频路径(JSON数组) |
| notes | TEXT | 备注 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

### 3.2 房源表 (properties)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键自增 |
| community_id | INTEGER | 关联小区ID |
| building | TEXT | 楼号 |
| unit | TEXT | 单元 |
| room | TEXT | 房号 |
| area | REAL | 面积(平米) |
| layout | TEXT | 户型 |
| floor | TEXT | 楼层 |
| orientation | TEXT | 朝向 |
| decoration | TEXT | 装修情况 |
| price | REAL | 挂牌价格(万) |
| price_per_sqm | REAL | 单价(元/平米) |
| rent | REAL | 租金(/月) |
| rent_ratio | REAL | 租售比(%) |
| expected_price | REAL | 预计价格(万) |
| visit_date | DATE | 看房日期 |
| photos | TEXT | 照片路径(JSON数组) |
| videos | TEXT | 视频路径(JSON数组) |
| notes | TEXT | 备注 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

### 3.3 用户表 (users)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键自增 |
| username | TEXT | 用户名(唯一) |
| password_hash | TEXT | 密码(bcrypt加密) |
| role | TEXT | 角色(admin/viewer) |
| created_at | DATETIME | 创建时间 |

---

## 4. 功能模块

### 4.1 认证模块

- 管理密码设置（初始由用户自定义）
- 家人查看密码（只读权限）
- JWT Token 身份验证
- Token 有效期 7 天

### 4.2 小区管理

- 新增小区（填写基本信息）
- 编辑小区
- 删除小区（级联删除关联房源）
- 查看小区列表（支持按区筛选）
- 小区详情（包含照片/视频）
- 上传小区照片/视频

### 4.3 房源管理

- 新增房源（关联小区）
- 编辑房源（自动计算租售比）
- 删除房源
- 查看房源列表（支持多维度筛选）
- 房源详情（包含照片/视频）
- 上传房源照片/视频

### 4.4 筛选功能

- 按区筛选
- 按价格区间筛选
- 按户型筛选
- 按租售比筛选
- 按环境打分筛选
- 关键词搜索

### 4.5 统计仪表盘

- 房源总数
- 小区总数
- 平均价格
- 价格区间分布

---

## 5. API 设计

### 5.1 认证接口

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/auth/login | 登录获取 Token |
| POST | /api/auth/change-password | 修改密码 |

### 5.2 小区接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/communities | 获取小区列表 |
| GET | /api/communities/{id} | 获取小区详情 |
| POST | /api/communities | 新增小区 |
| PUT | /api/communities/{id} | 更新小区 |
| DELETE | /api/communities/{id} | 删除小区 |

### 5.3 房源接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/properties | 获取房源列表 |
| GET | /api/properties/{id} | 获取房源详情 |
| POST | /api/properties | 新增房源 |
| PUT | /api/properties/{id} | 更新房源 |
| DELETE | /api/properties/{id} | 删除房源 |

### 5.4 文件上传

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/upload | 上传文件 |

---

## 6. 前端页面设计

### 6.1 页面结构

```
├── 登录页 (/login)
├── 首页/仪表盘 (/dashboard)
├── 小区管理
│   ├── 小区列表 (/communities)
│   └── 小区详情 (/communities/:id)
├── 房源管理
│   ├── 房源列表 (/properties)
│   └── 房源详情 (/properties/:id)
└── 个人设置 (/settings)
```

### 6.2 核心页面布局

**头部导航**
```
┌─────────────────────────────────────────────────────────────┐
│  🏠 房源管理系统                      [用户名] [退出]        │
├─────────────────────────────────────────────────────────────┤
│  [仪表盘] [小区] [房源]                                      │
└─────────────────────────────────────────────────────────────┘
```

**小区列表页**
```
┌─────────────────────────────────────────────────────────────┐
│  小区列表                                     [+ 添加小区]   │
├─────────────────────────────────────────────────────────────┤
│  筛选: [所在区 ▼]  [搜索小区名]                              │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 浦东新区 | 陆家嘴花园 | 环境 8分 | 对口明珠小学      │    │
│  │ [查看] [编辑] [删除]                                 │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 静安区 | 静安四季 | 环境 7分 | 对口一师附小          │    │
│  │ [查看] [编辑] [删除]                                 │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

**房源列表页**
```
┌─────────────────────────────────────────────────────────────┐
│  房源列表                                     [+ 添加房源]   │
├─────────────────────────────────────────────────────────────┤
│  筛选: [所在区 ▼] [户型 ▼] [价格区间] [搜索]                │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 陆家嘴花园 3室2厅 120㎡ 800万 租金 6000/月          │    │
│  │ 租售比 0.9% 预计 750万  2024-01-15 看房             │    │
│  │ [查看] [编辑] [删除]                                 │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

---

## 7. 安全措施

- ✅ 密码 bcrypt 加密存储
- ✅ JWT Token 身份验证
- ✅ 管理员/查看者角色分离
- ✅ 文件路径不直接暴露
- ✅ API 请求频率限制
- ✅ Cloudflare DDoS 防护

---

## 8. 开发计划

| 阶段 | 内容 | 预计工作量 |
|------|------|-----------|
| **Phase 1** | 项目初始化 + 数据库模型 | 1-2 天 |
| **Phase 2** | 后端 API 开发 | 2-3 天 |
| **Phase 3** | 前端界面开发 | 3-5 天 |
| **Phase 4** | 文件上传功能 | 1-2 天 |
| **Phase 5** | 部署上线 | 1 天 |

**总计**：约 8-13 天

---

## 9. 部署配置

### 9.1 Cloudflare 免费额度

| 服务 | 免费额度 |
|------|---------|
| Pages | 500 分钟/月 |
| Workers | 10万次/天 |
| R2 | 10GB 存储/月 |

### 9.2 环境变量

```env
# 后端配置
DATABASE_URL=sqlite:///./housing.db
JWT_SECRET=your-secret-key
R2_ACCESS_KEY=xxx
R2_SECRET_KEY=xxx
R2_BUCKET_NAME=housing-files
R2_PUBLIC_URL=https://xxx.r2.cloudflarestorage.com
```

---

## 10. 后续迭代（可选）

- [ ] 导出功能（Excel/PDF）
- [ ] 地图展示房源位置
- [ ] 价格趋势图表
- [ ] 房源对比功能
- [ ] 移动端 PWA 支持
- [ ] 消息推送（价格变动提醒）

---

**文档状态**：已确认 ✓
